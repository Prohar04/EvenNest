{% extends 'base.html' %}
{% load cart_tags %}

{% block title %}My Bookings - EventNest{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <h1 style="margin-bottom: var(--spacing-2xl);">My Bookings</h1>

        {% if bookings %}
        <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">
            {% for booking in bookings %}
            <div class="card" style="overflow: hidden;">
                <!-- Booking Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: var(--spacing-lg); border-bottom: 2px solid var(--bg-tertiary); margin-bottom: var(--spacing-lg);">
                    <div>
                        <h3 style="margin-bottom: var(--spacing-sm); font-size: 1.5rem;">{{ booking.get_service_type_display }} #{{ booking.id }}</h3>
                        <p style="color: var(--text-tertiary); margin-bottom: var(--spacing-xs);">
                            <i class="bi bi-calendar3"></i> {{ booking.date|date:"F d, Y" }} at {{ booking.time_slot|time:"g:i A" }}
                        </p>
                        <p style="color: var(--text-tertiary); font-size: 0.9rem;">
                            <i class="bi bi-clock-history"></i> Booked {{ booking.created_at|date:"M d, Y" }}
                        </p>
                    </div>
                    <div style="text-align: right;">
                        <p style="color: var(--text-tertiary); margin-bottom: var(--spacing-xs); font-size: 0.9rem;">Total Amount</p>
                        <p style="font-weight: 700; font-size: 1.8rem; color: var(--primary); margin-bottom: var(--spacing-md);">৳{{ booking.total_amount|floatformat:0 }}</p>
                    </div>
                </div>

                <!-- Service Details -->
                {% with service=booking.get_service %}
                {% if service %}
                <div style="margin-bottom: var(--spacing-lg); padding-bottom: var(--spacing-lg); border-bottom: 1px solid var(--bg-tertiary);">
                    <h4 style="margin-bottom: var(--spacing-md); color: var(--text-secondary);">Service Details</h4>
                    <div style="display: flex; gap: var(--spacing-lg); align-items: flex-start;">
                        <img src="{{ service.image.url }}" alt="{{ service.title }}" style="width: 120px; height: 120px; object-fit: cover; border-radius: var(--radius-md);">
                        <div style="flex: 1;">
                            <h5 style="margin-bottom: var(--spacing-md); color: var(--text-primary);">{{ service.title }}</h5>
                            {% if booking.requirements %}
                            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md); line-height: 1.6;">
                                <strong>Requirements:</strong> {{ booking.requirements|truncatewords:30 }}
                            </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endwith %}

                <!-- Status Timeline -->
                <div style="margin-bottom: var(--spacing-lg);">
                    <div style="display: flex; align-items: center; gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                        <div style="flex: 1;">
                            <h4 style="margin-bottom: var(--spacing-sm); color: var(--text-secondary);">Booking Status</h4>
                            <!-- Timeline visualization -->
                            <div style="display: flex; gap: 0; align-items: center; margin: var(--spacing-lg) 0;">
                                <!-- Pending -->
                                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; margin-bottom: var(--spacing-sm); {% if booking.status == 'pending' or booking.status in 'confirmed,completed' %}background-color: #7C3AED;{% else %}background-color: #D1D5DB;{% endif %} transition: all 0.3s ease;">
                                        <i class="bi bi-hourglass-split" style="font-size: 1.2rem;"></i>
                                    </div>
                                    <p style="text-align: center; font-size: 0.85rem; font-weight: 600; color: {% if booking.status == 'pending' or booking.status in 'confirmed,completed' %}var(--primary){% else %}var(--text-tertiary){% endif %};">Pending</p>
                                </div>
                                <!-- Connector 1 -->
                                <div style="flex: 0.5; height: 3px; background-color: {% if booking.status in 'confirmed,completed' %}#7C3AED{% else %}#D1D5DB{% endif %}; transition: background-color 0.3s ease;"></div>
                                
                                <!-- Confirmed -->
                                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; margin-bottom: var(--spacing-sm); {% if booking.status == 'confirmed' or booking.status == 'completed' %}background-color: #7C3AED;{% else %}background-color: #D1D5DB;{% endif %} transition: all 0.3s ease;">
                                        <i class="bi bi-check-circle" style="font-size: 1.2rem;"></i>
                                    </div>
                                    <p style="text-align: center; font-size: 0.85rem; font-weight: 600; color: {% if booking.status == 'confirmed' or booking.status == 'completed' %}var(--primary){% else %}var(--text-tertiary){% endif %};">Confirmed</p>
                                </div>
                                <!-- Connector 2 -->
                                <div style="flex: 0.5; height: 3px; background-color: {% if booking.status == 'completed' %}#7C3AED{% else %}#D1D5DB{% endif %}; transition: background-color 0.3s ease;"></div>
                                
                                <!-- Completed -->
                                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; margin-bottom: var(--spacing-sm); {% if booking.status == 'completed' %}background-color: #10B981;{% else %}background-color: #D1D5DB;{% endif %} transition: all 0.3s ease;">
                                        <i class="bi bi-check2-all" style="font-size: 1.2rem;"></i>
                                    </div>
                                    <p style="text-align: center; font-size: 0.85rem; font-weight: 600; color: {% if booking.status == 'completed' %}#10B981{% else %}var(--text-tertiary){% endif %};">Completed</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Badge & Alert -->
                    <div style="display: flex; gap: var(--spacing-md); align-items: center; margin-bottom: var(--spacing-lg);">
                        <div style="padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-lg); {% if booking.status == 'completed' %}background-color: #ECFDF5; border-left: 4px solid #10B981;{% elif booking.status == 'confirmed' %}background-color: #EFF6FF; border-left: 4px solid #3B82F6;{% elif booking.status == 'pending' %}background-color: #FEF3C7; border-left: 4px solid #FCD34D;{% else %}background-color: #FEE2E2; border-left: 4px solid #EF4444;{% endif %}">
                            <span style="font-weight: 600; {% if booking.status == 'completed' %}color: #047857;{% elif booking.status == 'confirmed' %}color: #1E40AF;{% elif booking.status == 'pending' %}color: #78350F;{% else %}color: #7F1D1D;{% endif %}">
                                <i class="bi {% if booking.status == 'completed' %}bi-check-circle{% elif booking.status == 'confirmed' %}bi-check-lg{% elif booking.status == 'pending' %}bi-clock{% else %}bi-x-circle{% endif %}" style="margin-right: var(--spacing-sm);"></i>
                                {{ booking.get_status_display|upper }}
                            </span>
                        </div>
                        {% if booking.status == 'completed' %}
                        <span style="font-size: 0.85rem; color: #10B981; font-weight: 600;">✓ Service Completed</span>
                        {% elif booking.status == 'confirmed' %}
                        <span style="font-size: 0.85rem; color: #3B82F6; font-weight: 600;">✓ Confirmed</span>
                        {% elif booking.status == 'pending' %}
                        <span style="font-size: 0.85rem; color: #F59E0B; font-weight: 600;">⏳ Awaiting confirmation</span>
                        {% else %}
                        <span style="font-size: 0.85rem; color: #EF4444; font-weight: 600;">✗ Booking cancelled</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: var(--spacing-3xl) var(--spacing-xl);">
            <i class="bi bi-calendar-x" style="font-size: 4rem; color: var(--bg-tertiary); margin-bottom: var(--spacing-lg); display: block;"></i>
            <h3 style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">No Bookings Yet</h3>
            <p style="color: var(--text-tertiary); margin-bottom: var(--spacing-lg);">You haven't made any service bookings. Browse our services to get started!</p>
            <a href="{% url 'all_services' %}" style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: var(--spacing-md) var(--spacing-xl); border-radius: var(--radius-md); text-decoration: none; font-weight: 600; transition: all 0.3s ease;">
                <i class="bi bi-calendar-plus"></i> Browse Services
            </a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
